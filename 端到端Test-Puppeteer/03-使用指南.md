## ğŸ‘‹ Hi, Nice to meet you ~

æˆ‘æ˜¯å°é‘«åŒå­¦ï¼Œåœ¨åŒ—äº¬å·¥ä½œçš„ä¸€ä½å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆã€‚æˆ‘æ“…é•¿ä½¿ç”¨ [Vue.js](https://cn.vuejs.org/)ã€ [Angular](https://angular.cn/)ã€ [Typescript](https://www.typescriptlang.org/) å’Œ [Node.js](https://www.nodejs.com.cn/) æ„å»º [Web](https://developer.mozilla.org/zh-CN/docs/Web) åº”ç”¨ç¨‹åºå’Œç½‘ç«™ã€‚åŒæ—¶æˆ‘ä¹Ÿæ˜¯ä¸€ä½ä¹äºåˆ†äº«çš„ç¨‹åºå‘˜ï¼Œæˆ‘ç»å¸¸åˆ©ç”¨ä¼‘æ¯æ—¶é—´å†™å†™æŠ€æœ¯æ–‡ç« ã€åˆ†äº«è‡ªå·±ç»éªŒåŠå­¦ä¹ å¿ƒå¾—ã€‚

è¿‘ä¸¤å¹´ä¸»è¦åˆ©ç”¨ [MicroApp](https://micro-zoe.github.io/micro-app/) å¾®å‰ç«¯æ¡†æ¶ç»´æŠ¤å’Œè¿­ä»£å…¬å¸çš„é¡¹ç›®ï¼Œä¿è¯å†å²çš„ [Angular](https://angular.cn/) å·¥ç¨‹é€æ­¥å‘ [Vue.js](https://cn.vuejs.org/) çš„å¹³ç¨³è¿ç§»ã€‚

åº§å³é“­: ğŸ˜‡ æ‰€æœ‰ä»˜å‡ºéƒ½å°†æ˜¯æ²‰æ·€ï¼Œæ‰€æœ‰ç¾å¥½ç»ˆä¼šå¦‚æœŸè€Œè‡³

# ä½¿ç”¨æŒ‡å—



## é…ç½®ï¼š



## è°ƒè¯•ï¼š

ç”±äº Puppeteer è®¾è®¡æµè§ˆå™¨çš„è®¸å¤šä¸åŒç»„ä»¶ï¼Œå› æ­¤æ²¡æœ‰ç»Ÿä¸€çš„æ–¹å¼è°ƒè¯•æ‰€æœ‰çš„å¯èƒ½å¾—é—®é¢˜ï¼ŒPuppeteer å°½å¯èƒ½çš„æä¾›å¤šç§è°ƒè¯•æ–¹æ³•æ¥æ¶µç›–æ‰€æœ‰å¯èƒ½å¾—é—®é¢˜ã€‚

ä¸€èˆ¬æ¥è¯´åœ¨ä½¿ç”¨ Puppeteer çš„æ—¶å€™ä¸»è¦çš„é—®é¢˜æ¥è‡ªä¸¤ä¸ªæ¥æºï¼šåœ¨ Node.js ä¸Šè¿è¡Œçš„ä»£ç ï¼ˆç§°ä¹‹ä¸ºæœåŠ¡ç«¯ä»£ç ï¼‰å’Œåœ¨æµè§ˆå™¨ç«¯è¿è¡Œçš„ä»£ç ï¼ˆç§°ä¹‹ä¸ºå®¢æˆ·ç«¯ä»£ç ï¼‰ã€‚

### åŸºç¡€é…ç½®ï¼š

å› ä¸ºè°ƒè¯•å¾€å¾€å‘ç”Ÿåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæ‰€ä»¥æä¾›ä¸€ä¸ªç¯å¢ƒå˜é‡æ¥åŠ¨æ€å¯åŠ¨è°ƒè¯•çš„åŸºç¡€é…ç½®è¿˜æ˜¯æœ‰å¾ˆå¸®åŠ©çš„ï¼š

1. ç¦ç”¨æ— å¤´æ¨¡å¼ï¼šå¯ä»¥æŸ¥çœ‹æµè§ˆå™¨æ˜¾ç¤ºçš„å†…å®¹ï¼Œä¸»è§‚çš„è§‚å¯Ÿå†…å®¹å˜åŒ–ï¼›
2. å»¶é•¿æ‰§è¡Œæ—¶é—´ï¼šé€šè¿‡å»¶é•¿æ‰§è¡Œæ—¶é—´æ¥è§‚å¯Ÿæ­£åœ¨å‘ç”Ÿçš„æƒ…å†µï¼›
3. å¯ç”¨æµè§ˆå™¨è°ƒè¯•ï¼šè°ƒè¯•æ—¶ä¼šè‡ªåŠ¨å¯åŠ¨å¼€å‘è€…å·¥å…·ï¼›
4. æ‰“å°æµè§ˆå™¨æ—¥å¿—ï¼šå¯ç”¨åå¯ä»¥æ¥ç®¡æµè§ˆå™¨æ„å¤–å´©æºƒæˆ–æ— æ³•æ­£å¸¸å¯åŠ¨æ—¶çš„æ—¥å¿—ä¿¡æ¯ã€‚

```javascript
import puppeteer from 'puppeteer'

const production = process.env.NODE_ENV === 'production';

(async () => {
    const browser = await puppeteer.launch({
        // å¼€å‘ç¯å¢ƒä¸­ä¸ä½¿ç”¨æ— å¤´æ¨¡å¼
        headless: production,
        // å¼€å‘ç¯å¢ƒä¸­å»¶é•¿æ‰§è¡Œæ—¶é—´
        slowMo: production ? 0 : 250,
        // å¼€å‘ç¯å¢ƒä¸­æ‰“å¼€å¼€å‘è€…å·¥å…·
        devtools: production ? false : true,
        // å¼€å‘ç¯å¢ƒä¸­è¾“å‡ºæµè§ˆå™¨è¿›ç¨‹ä¿¡æ¯
        dumpio: production ? false : true,
    })
})()
```

### å®¢æˆ·ç«¯ä»£ç è°ƒè¯•ï¼š

1. æ•è·å®¢æˆ·ç«¯ä»£ç ä¸­çš„ `console.*` çš„è¾“å‡ºï¼š

   ```javascript
   // ç›‘å¬é¡µé¢çš„ console.* è¾“å‡º 
   page.on('console', msg => {
       console.log('PAGE LOG: ', msg.text())
   })
   
   // æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒä¸­ console.* è¾“å‡º
   await page.evaluate(() => {
       console.log('PAGE EVAL: ', 'Hello World!')
   })
   ```

2. æ·»åŠ  `debugger;` å…³é”®å­—ä¸­æ–­ä»£ç ï¼š

   ```javascript
   // æ³¨æ„å¯ç”¨ devtools é€‰é¡¹
   await page.evaluate(() => {
     	// æ¨¡æ‹Ÿå®¢æˆ·ç«¯ä»£ç ä¸­ä½¿ç”¨ debugger; å…³é”®å­—ä¸­æ–­ä»£ç æ‰§è¡Œ
     	debugger;
       console.log('PAGE EVAL: ', 'Hello World!')
   })
   ```

### æœåŠ¡ç«¯ä»£ç è°ƒè¯•ï¼š

åœ¨ Node.js ä¸­ä½¿ç”¨è°ƒè¯•å™¨ä»…é™äº Chrome å’Œ Chromium ä¸­ä½¿ç”¨ã€‚

1. åœ¨å…³é—­æ— å¤´æ¨¡å¼çš„å‰æä¸‹ï¼Œéœ€è¦åœ¨è¿è¡ŒæœåŠ¡ç«¯ä»£ç çš„è„šæœ¬ä¸­æ·»åŠ  `--inspect-brk` é€‰é¡¹ï¼Œå¦‚ï¼š

```shell
npm pkg set scripts.debug="cross-env NODE_ENV=development node --inspect-brk index.mjs" // v7.24.2 +
```

2. åœ¨ Chrome æˆ– Chromium ä¸­æ‰“å¼€ `chrome://inspect/#devices` ï¼Œåœ¨æ–°é¡µé¢ä¸­çš„ Remote Target èœå•ä¸‹æ‰¾åˆ°å¯¹åº”çš„ Target å¹¶å¯åŠ¨è°ƒè¯•ã€‚
3. åœ¨æ–°æ‰“å¼€çš„æµè§ˆå™¨ä¸­ï¼ŒæŒ‰ `F8` å¯ä»¥æ¢å¤æµ‹è¯•æ‰§è¡Œï¼›
4. æ·»åŠ çš„ `debugger;` å…³é”®å­—ä¹Ÿä¼šè¢«å‘½ä¸­å¹¶ä¸­æ–­ç¨‹åºæ‰§è¡Œï¼›

### è®°å½• DevTools åè®®æµé‡ï¼š

ä»¥ä¸Šçš„è°ƒè¯•æ–¹æ³•éƒ½ä¸èµ·ä½œç”¨æ—¶ï¼Œåˆ™å¯èƒ½æ˜¯ Puppeteer å’Œ DevTools åè®®ä¹‹é—´å¯èƒ½å­˜åœ¨ç€é—®é¢˜ï¼Œé‚£è¿™æ—¶å€™å¯ä»¥é€šè¿‡è®¾ç½® DEBUG ç¯å¢ƒå˜é‡æ¥è¿›ä¸€æ­¥è°ƒè¯•ï¼š

```javascript
# åŸºæœ¬è¯¦ç»†æ—¥å¿—è®°å½•
cross-env DEBUG="puppeteer:*" node script.js

# é˜²æ­¢æˆªæ–­é•¿æ¶ˆæ¯
cross-env DEBUG="puppeteer:*" env DEBUG_MAX_STRING_LENGTH=null node script.js

# åè®®é€šä¿¡å¯èƒ½ç›¸å½“ç¹æ‚ã€‚æ­¤ç¤ºä¾‹è¿‡æ»¤æ‰æ‰€æœ‰ç½‘ç»œåŸŸæ¶ˆæ¯
cross-env DEBUG="puppeteer:*" env DEBUG_COLORS=true node script.js 2>&1 | grep -v '"Network'

# è¿‡æ»¤æ‰æ‰€æœ‰åè®®æ¶ˆæ¯ï¼Œä½†ä¿ç•™æ‰€æœ‰å…¶ä»–æ—¥å¿—è®°å½•
cross-env DEBUG="puppeteer:*,-puppeteer:protocol:*" node script.js
```

### è®°å½•å¾…å¤„ç†çš„åè®®è°ƒç”¨ï¼š

å¦‚æœé‡åˆ° Puppeteer å¼‚æ­¥ä»»åŠ¡æœªèƒ½å˜ä¸º **Fulfilled** çŠ¶æ€æ—¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ debugInfo å€Ÿå£è®°å½•è¢«æŒ‚èµ·çš„å›è°ƒï¼Œå¹¶æŸ¥çœ‹å¯¼è‡´çš„åŸå› ï¼š

```javascript
console.log(browser.debugInfo.pendingProtocolErrors);
```

## è¯·æ±‚æ‹¦æˆªï¼š



## æ— å¤´æ¨¡å¼ï¼š

é»˜è®¤æƒ…å†µä¸‹ï¼ŒPuppeteer ä¼šä»¥ `Headless` æ¨¡å¼å¯ç”¨æµè§ˆå™¨ã€‚

```javascript
const browser = await puppeteer.launch();
// ç›¸å½“äº
const browser = await puppeteer.launch({headless: true});
```

åœ¨ v22 ç‰ˆæœ¬ä¹‹å‰ï¼ŒPuppeteer é»˜è®¤å¯ç”¨æ—§çš„ Headless æ¨¡å¼ï¼ˆ`chrome-headless-shell` ç‹¬ç«‹äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ã€‚`chrome-headless-shell` äºé€šå¸¸çš„ Chrome çš„è¡Œä¸ºä¸å®Œå…¨åŒ¹é…ï¼Œä½†ç›®å‰å¯¹äºä¸éœ€è¦å®Œæ•´ Chrome åŠŸèƒ½é›†çš„è‡ªåŠ¨åŒ–ä»»åŠ¡æ¥è¯´ï¼Œæ€§èƒ½ä¼šæ›´æœ‰ä¼˜åŠ¿ã€‚å¦‚æœå¯¹æ€§èƒ½æœ‰æ›´é«˜çš„è¦æ±‚å¯ä»¥åˆ‡æ¢åˆ° `chrome-headless-shell`ï¼š

```javascript
const browser = await puppeteer.launch({headless: 'shell'});
```

è¦å¯åŠ¨ Chrome çš„ `headful` ç‰ˆæœ¬ï¼Œå¯ä»¥è¿›è¡Œ `headless` é€‰é¡¹ï¼š

```javascript
const browser = await puppeteer.launch({headless: false});
```

## æˆªå›¾ï¼š

è¦æ•è·å±å¹•æˆªå›¾å¯ä»¥ä½¿ç”¨ `await page.screenshot({ path: 'screenshot.png', });`ã€‚

è¦æ•è·ç‰¹å®šå…ƒç´ çš„æˆªå›¾å¯ä»¥ä½¿ç”¨ï¼š

```javascript
const element = await page.waitForSelector('div');
await element.screenshot({
  path: 'screenshot.png',
});
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå…ƒç´ å¤„äº `hidden` çŠ¶æ€ï¼Œ`ElementHandle.screenshot()` ä¼šå°è¯•å°†å…¶æ»šåŠ¨åˆ°è§†å›¾ä¸­ã€‚

## PDF ç”Ÿæˆï¼š



## Chrome æ‰©å±•ï¼š



## Cookiesï¼š



## æ–‡ä»¶ï¼š



## åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ Puppeteerï¼š



## åœ¨ Chrome æ‰©å±•ä¸­è¿è¡Œ Puppeteerï¼š

